# Система обмена зашифрованными сообщениями на основе RSA

## Содержание
1. [Общее описание](#общее-описание)
2. [Архитектура системы](#архитектура-системы)
3. [Технологический стек](#технологический-стек)
4. [Компоненты системы](#компоненты-системы)
   - [Backend (FastAPI)](#backend-fastapi)
   - [Frontend (React)](#frontend-react)
   - [База данных (PostgreSQL)](#база-данных-postgresql)
   - [Nginx](#nginx)
   - [Мониторинг (Prometheus + Grafana)](#мониторинг-prometheus--grafana)
5. [API Endpoints](#api-endpoints)
6. [WebSocket функционал](#websocket-функционал)
7. [Шифрование](#шифрование)
8. [Установка и запуск](#установка-и-запуск)
9. [Структура проекта](#структура-проекта)

## Общее описание

Данный проект представляет собой систему обмена зашифрованными сообщениями, использующую алгоритм RSA для шифрования. Система позволяет пользователям регистрироваться, генерировать пары ключей (публичный и приватный), отправлять и получать зашифрованные сообщения в реальном времени. Проект включает в себя мониторинг производительности через Prometheus и Grafana.

## Архитектура системы

Система построена на микросервисной архитектуре и состоит из следующих основных компонентов:
- Frontend-приложение на React
- Backend-сервер на FastAPI
- База данных PostgreSQL
- Nginx в качестве reverse proxy
- Prometheus для сбора метрик
- Grafana для визуализации метрик

Все компоненты развертываются в Docker-контейнерах, что обеспечивает изоляцию и простоту развертывания.

## Технологический стек

### Backend:
- Python 3.9+
- FastAPI
- SQLAlchemy
- PostgreSQL
- WebSockets
- Pydantic
- Prometheus Client

### Frontend:
- React
- Tailwind CSS
- WebSocket
- Axios

### Инфраструктура:
- Docker
- Docker Compose
- Nginx
- Prometheus
- Grafana

## Компоненты системы

### Backend (FastAPI)

Backend-сервер реализует REST API и WebSocket-соединения для обмена сообщениями в реальном времени.

#### Основные модули:
1. **main.py** - основной файл приложения, содержащий все эндпоинты и WebSocket-обработчики
2. **database.py** - конфигурация подключения к базе данных
3. **models/** - модели данных SQLAlchemy
4. **schemas/** - Pydantic-модели для валидации данных
5. **utils/rsa.py** - реализация алгоритма RSA
6. **metrics.py** - метрики для Prometheus

#### Метрики:
- Количество отправленных сообщений
- Количество операций шифрования/дешифрования
- Количество активных пользователей
- Задержка обработки сообщений
- Количество активных WebSocket соединений

### Frontend (React)

Frontend-приложение предоставляет пользовательский интерфейс для взаимодействия с системой.

#### Основные компоненты:
1. **App.js** - корневой компонент приложения
   - Управление состоянием авторизации
   - Маршрутизация
   - WebSocket подключение

2. **Chat.js** - компонент чата
   - Отображение сообщений
   - Отправка сообщений
   - Шифрование/дешифрование
   - Управление WebSocket соединением
   - Просмотр ключей RSA
   - История сообщений

3. **Login.js** - компонент авторизации
   - Форма входа/регистрации
   - Валидация полей
   - Обработка ошибок

#### Хуки:
- **useWebSocket** - управление WebSocket соединением
  - Автоматическое переподключение
  - Обработка ошибок
  - Отправка сообщений

### База данных (PostgreSQL)

База данных хранит информацию о пользователях и сообщениях.

#### Основные таблицы:
1. **users**
   - id (PK)
   - nickname (unique)
   - public_key
   - private_key
   - created_at

2. **messages**
   - id (PK)
   - content
   - encrypted_content
   - sender_id (FK)
   - receiver_id (FK)
   - timestamp

### Nginx

Nginx используется как reverse proxy и для раздачи статических файлов.

### Мониторинг (Prometheus + Grafana)

Система включает в себя мониторинг производительности через Prometheus и Grafana.

#### Метрики:
- Количество сообщений
- Количество операций шифрования/дешифрования
- Количество активных пользователей
- Задержка обработки сообщений
- Количество WebSocket соединений

## API Endpoints

### Пользователи

#### POST /api/users/create
Создание нового пользователя с автоматической генерацией ключей RSA.

```json
Request:
{
    "nickname": "string"
}

Response:
{
    "id": "integer",
    "nickname": "string",
    "public_key": "string",
    "private_key": "string"
}
```

#### GET /api/users
Получение списка всех пользователей.

```json
Response:
[
    {
        "id": "integer",
        "nickname": "string",
        "public_key": "string"
    }
]
```

### Сообщения

#### POST /api/messages
Создание нового сообщения.

```json
Request:
{
    "content": "string",
    "encrypted_content": "string",
    "receiver_id": "integer"
}

Response:
{
    "id": "integer",
    "content": "string",
    "encrypted_content": "string",
    "sender_id": "integer",
    "receiver_id": "integer",
    "timestamp": "datetime"
}
```

#### GET /api/messages/{user_id}
Получение истории сообщений пользователя.

```json
Response:
[
    {
        "id": "integer",
        "content": "string",
        "encrypted_content": "string",
        "sender_id": "integer",
        "receiver_id": "integer",
        "timestamp": "datetime"
    }
]
```

### Шифрование

#### POST /api/encrypt
Шифрование сообщения с использованием публичного ключа.

```json
Request:
{
    "text": "string",
    "public_key": "string"
}

Response:
{
    "encrypted_text": "string"
}
```

#### POST /api/decrypt
Расшифровка сообщения с использованием приватного ключа.

```json
Request:
{
    "encrypted_text": "string",
    "private_key": "string"
}

Response:
{
    "decrypted_text": "string"
}
```

## WebSocket функционал

### Endpoint: /ws/{user_id}

WebSocket-соединение используется для обмена сообщениями в реальном времени.

#### Отправка сообщения:
```json
{
    "content": "string",
    "encrypted_content": "string",
    "receiver_id": "integer"
}
```

#### Получение сообщения:
```json
{
    "type": "message",
    "data": {
        "id": "integer",
        "content": "string",
        "encrypted_content": "string",
        "sender_id": "integer",
        "receiver_id": "integer",
        "timestamp": "datetime"
    }
}
```

## Шифрование

### Алгоритм RSA

Система использует алгоритм RSA для шифрования сообщений. Процесс включает:
1. Генерацию пары ключей (публичный и приватный)
2. Шифрование сообщения с использованием публичного ключа получателя
3. Расшифровку сообщения с использованием приватного ключа получателя

### Безопасность

- Приватные ключи хранятся только на стороне клиента
- Сообщения передаются в зашифрованном виде
- Используется HTTPS для защиты передачи данных
- WebSocket-соединения защищены

## Установка и запуск

### Требования
- Docker
- Docker Compose

### Запуск проекта

1. Клонировать репозиторий:
```bash
git clone <repository-url>
cd rsa_modern
```

2. Создать файл .env с необходимыми переменными окружения:
```bash
# Server ports
NGINX_PORT=80
BACKEND_PORT=8000
FRONTEND_PORT=3000
GRAFANA_PORT=3001
PROMETHEUS_PORT=9090

# Database configuration
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=rsa_db
POSTGRES_PORT=5432

# Grafana configuration
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin
```

3. Запустить проект:
```bash
# Сделать скрипт исполняемым
chmod +x docker-compose.sh

# Запустить проект
./docker-compose.sh up
```

4. Выбрать режим запуска:
- Локальный режим (localhost)
- Сетевой режим (доступен с других устройств)

5. После запуска доступны:
- Приложение: http://localhost
- Grafana: http://localhost:3001
- Prometheus: http://localhost:9090

### Остановка проекта
```bash
./docker-compose.sh down
```

## Структура проекта

```
rsa_modern/
├── backend/
│   ├── app/
│   │   ├── main.py
│   │   ├── database.py
│   │   ├── metrics.py
│   │   ├── models/
│   │   │   ├── __init__.py
│   │   │   ├── user.py
│   │   │   └── message.py
│   │   ├── schemas/
│   │   │   ├── __init__.py
│   │   │   ├── user.py
│   │   │   └── message.py
│   │   └── utils/
│   │       ├── __init__.py
│   │       └── rsa.py
│   ├── Dockerfile
│   └── requirements.txt
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   │   ├── Chat.js
│   │   │   └── Login.js
│   │   ├── hooks/
│   │   │   └── useWebSocket.js
│   │   ├── utils/
│   │   │   └── rsa.js
│   │   ├── App.js
│   │   ├── config.js
│   │   └── index.js
│   ├── Dockerfile
│   └── package.json
├── nginx/
│   ├── default.conf
│   ├── nginx.conf
│   └── Dockerfile
├── prometheus/
│   └── prometheus.yml
├── grafana/
│   ├── dashboards/
│   └── provisioning/
├── docker-compose.yml
├── docker-compose.sh
└── .env
```

## Особенности реализации

### Backend

1. **FastAPI** выбран как основной фреймворк благодаря:
   - Высокой производительности
   - Автоматической генерации документации
   - Поддержке асинхронного программирования
   - Встроенной валидации данных

2. **SQLAlchemy** используется для работы с базой данных:
   - ORM для удобной работы с данными
   - Миграции для управления схемой базы данных
   - Поддержка различных типов баз данных

3. **WebSockets** реализуют обмен сообщениями в реальном времени:
   - Поддержка множества одновременных соединений
   - Обработка отключений и ошибок
   - Сохранение истории сообщений

### Frontend

1. **React** обеспечивает:
   - Компонентный подход к разработке
   - Эффективное обновление DOM
   - Управление состоянием приложения

2. **Tailwind CSS** предоставляет:
   - Готовые компоненты интерфейса
   - Адаптивный дизайн
   - Темы оформления

3. **WebSocket** клиент:
   - Автоматическое переподключение
   - Обработка ошибок
   - Управление состоянием соединения

## Безопасность

1. **Шифрование данных**:
   - Использование RSA для шифрования сообщений
   - Безопасное хранение ключей
   - Защита передаваемых данных

2. **Аутентификация**:
   - Уникальные идентификаторы пользователей
   - Проверка существования пользователей
   - Валидация входных данных

3. **Сетевая безопасность**:
   - HTTPS для REST API
   - WSS для WebSocket соединений
   - Защита от CSRF и XSS атак

## Масштабируемость

1. **Архитектура**:
   - Микросервисный подход
   - Независимое масштабирование компонентов
   - Контейнеризация с Docker

2. **База данных**:
   - Поддержка репликации
   - Индексация для оптимизации запросов
   - Возможность горизонтального масштабирования

3. **Кэширование**:
   - Кэширование статических ресурсов
   - Оптимизация запросов к базе данных
   - Управление соединениями

## Мониторинг и логирование

1. **Логирование**:
   - Логирование ошибок и исключений
   - Отслеживание действий пользователей
   - Мониторинг производительности

2. **Метрики**:
   - Количество активных пользователей
   - Время отклика API
   - Использование ресурсов

## Заключение

Данный проект демонстрирует реализацию системы обмена зашифрованными сообщениями с использованием современных технологий и подходов к разработке. Система обеспечивает безопасный обмен сообщениями между пользователями, используя алгоритм RSA для шифрования, и предоставляет удобный пользовательский интерфейс для взаимодействия с системой. 